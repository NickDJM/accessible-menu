var AccessibleMenu=function(){"use strict";var e,t,n,o;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function l(e){var t="element";try{if(e instanceof HTMLElement)return!0;if("object"!==r(e))throw Error;for(var n in e)if(t=n,!(e[n]instanceof HTMLElement))throw Error}catch(e){throw new TypeError("".concat(t," must be an HTML Element."))}}function c(e){h(e);var t="value";try{if("object"===r(e))for(var n in e){if(t=n,"string"!=typeof e[n])throw Error;document.querySelector(e[n])}else document.querySelector(e);return!0}catch(e){throw new TypeError("".concat(t," must be a valid CSS selector."))}}function m(e){var t="value";try{if("boolean"==typeof e)return!0;if("object"!==r(e))throw Error;for(var n in e)if(t=n,"boolean"!=typeof e[n])throw Error}catch(e){throw new TypeError("".concat(t," must be a boolean."))}}function a(e){var t="value";try{if("number"==typeof e)return!0;if("object"!==r(e))throw Error;for(var n in e)if(t=n,"number"!=typeof e[n])throw Error}catch(e){throw new TypeError("".concat(t," must be a number."))}}function h(e){var t="value";try{if("string"==typeof e)return!0;if("object"!==r(e))throw Error;for(var n in e)if(t=n,"string"!=typeof e[n])throw Error}catch(e){throw new TypeError("".concat(t," must be a string."))}}function f(e){var t="element";try{if(e instanceof y)return!0;if("object"!==r(e))throw Error;for(var n in e)if(t=n,!(e[n]instanceof y))throw Error}catch(e){throw new TypeError("".concat(t," must be an instance of Menu"))}}function d(e){!function(e){var t="event";try{if(e instanceof KeyboardEvent)return!0;if("object"!==r(e))throw Error;for(var n in e)if(t=n,!(e[n]instanceof KeyboardEvent))throw Error}catch(e){throw new TypeError("".concat(t," must be a KeyboardEvent."))}}(e);try{var t=e.key||e.keyCode,n={Enter:"Enter"===t||13===t,Space:" "===t||"Spacebar"===t||32===t,Escape:"Escape"===t||"Esc"===t||27===t,ArrowUp:"ArrowUp"===t||"Up"===t||38===t,ArrowRight:"ArrowRight"===t||"Right"===t||39===t,ArrowDown:"ArrowDown"===t||"Down"===t||40===t,ArrowLeft:"ArrowLeft"===t||"Left"===t||37===t,Home:"Home"===t||36===t,End:"End"===t||35===t,Character:!!t.match(/^[a-zA-Z]{1}$/),Tab:"Tab"===t||9===t};return Object.keys(n).find((function(e){return!0===n[e]}))}catch(e){return""}}function v(e){!function(e){var t="event";try{if(e instanceof Event)return!0;if("object"!==r(e))throw Error;for(var n in e)if(t=n,!(e[n]instanceof Event))throw Error}catch(e){throw new TypeError("".concat(t," must be an Event."))}}(e),e.preventDefault(),e.stopPropagation()}Array.from||(Array.from=(e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=Math.pow(2,53)-1,o=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),n)},function(e){var n=this,r=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var s,u=arguments.length>1?arguments[1]:void 0;if(void 0!==u){if(!t(u))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(s=arguments[2])}for(var i,l=o(r.length),c=t(n)?Object(new n(l)):new Array(l),m=0;m<l;)i=r[m],c[m]=u?void 0===s?u(i,m):u.call(s,i,m):i,m+=1;return c.length=l,c})),Array.includes||(Array.prototype.includes=function(e){return!!~this.indexOf(e)}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var o=arguments[1],r=0;r<n;){var s=t[r];if(e.call(o,s,r,t))return s;r++}},configurable:!0,writable:!0});var p=function(){function e(t){var n=t.menuToggleElement,o=t.parentElement,r=t.controlledMenu,u=t.openClass,i=void 0===u?"show":u,c=t.parentMenu,m=void 0===c?null:c;s(this,e),l({menuToggleElement:n,parentElement:o}),f(null!==m?{controlledMenu:r,parentMenu:m}:{controlledMenu:r}),this.domElements={toggle:n,parent:o},this.menuElements={controlledMenu:r,parentMenu:m},this.openClass=i,this.isOpen=!1,this.initialize()}return i(e,[{key:"initialize",value:function(){if(this.dom.toggle.setAttribute("aria-haspopup","true"),this.dom.toggle.setAttribute("aria-expanded","false"),this.dom.toggle.setAttribute("role","button"),""===this.dom.toggle.id||""===this.elements.controlledMenu.dom.menu.id){var e=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10),t="".concat(this.dom.toggle.innerText.toLowerCase().replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s/g,"-"),"-").concat(e);this.dom.toggle.id=this.dom.toggle.id||"".concat(t,"-menu-button"),this.elements.controlledMenu.dom.menu.id=this.elements.controlledMenu.dom.menu.id||"".concat(t,"-menu")}this.elements.controlledMenu.dom.menu.setAttribute("aria-labelledby",this.dom.toggle.id),this.dom.toggle.setAttribute("aria-controls",this.elements.controlledMenu.dom.menu.id),this.handleClick()}},{key:"expand",value:function(){this.dom.toggle.setAttribute("aria-expanded","true"),this.dom.parent.classList.add(this.openClass),this.elements.controlledMenu.dom.menu.classList.add(this.openClass)}},{key:"open",value:function(e){this.isOpen=!0,this.expand(),this.closeSiblings(e),this.elements.parentMenu&&(this.elements.parentMenu.focusState="child"),this.elements.controlledMenu.focusState="self",e instanceof MouseEvent||this.elements.controlledMenu.focusFirstChild()}},{key:"preview",value:function(e){this.isOpen=!0,this.expand(),this.closeSiblings(e),this.elements.parentMenu&&(this.elements.parentMenu.focusState="self",e instanceof MouseEvent||this.elements.parentMenu.focusCurrentChild()),this.elements.controlledMenu.focusState="none"}},{key:"close",value:function(e){this.isOpen&&(this.isOpen=!1,this.dom.toggle.setAttribute("aria-expanded","false"),this.dom.parent.classList.remove(this.openClass),this.elements.controlledMenu.dom.menu.classList.remove(this.openClass),e instanceof MouseEvent||this.elements.controlledMenu.focusFirstChild(),this.closeChildren(e),this.elements.controlledMenu.blur(e),this.elements.parentMenu?(this.elements.parentMenu.focusState="self",e instanceof MouseEvent||this.elements.parentMenu.focusCurrentChild()):!this.elements.controlledMenu.isTopLevel||e instanceof MouseEvent||this.elements.controlledMenu.focusController())}},{key:"toggle",value:function(e){this.isOpen?this.close(e):this.open(e)}},{key:"closeSiblings",value:function(e){var t=this;try{this.elements.parentMenu.elements.submenuToggles.forEach((function(n){n!==t&&n.close(e)}))}catch(e){}}},{key:"closeChildren",value:function(e){this.elements.controlledMenu.elements.submenuToggles.forEach((function(t){return t.close(e)}))}},{key:"handleClick",value:function(){var e=this;this.dom.toggle.addEventListener("click",(function(t){v(t),e.toggle(t)}))}},{key:"dom",get:function(){return this.domElements}},{key:"elements",get:function(){return this.menuElements}},{key:"isOpen",get:function(){return this.show},set:function(e){m({value:e}),this.show=e}},{key:"openClass",get:function(){return this.controlledMenuOpenClass},set:function(e){h({value:e}),this.controlledMenuOpenClass=e}}]),e}(),b=function(){function e(t){var n=t.menuItemElement,o=t.menuLinkElement,u=t.parentMenu,i=t.isSubmenuItem,c=void 0!==i&&i,a=t.childMenu,h=void 0===a?null:a,d=t.toggle,v=void 0===d?null:d;s(this,e),l({menuItemElement:n,menuLinkElement:o}),m({isSubmenuItem:c}),f(null!==h?{parentMenu:u,childMenu:h}:{parentMenu:u}),null!==v&&function(e){var t="element";try{if(e instanceof p)return!0;if("object"!==r(e)||e instanceof p)throw Error;for(var n in e)if(t=n,!(e[n]instanceof p))throw Error}catch(e){throw new TypeError("".concat(t," must be a MenuToggle."))}}({toggle:v}),this.domElements={item:n,link:o},this.menuElements={parentMenu:u,childMenu:h,toggle:v},this.isController=c,this.initialize()}return i(e,[{key:"initialize",value:function(){this.dom.item.setAttribute("role","none"),this.dom.link.setAttribute("role","menuitem"),this.dom.link.tabIndex=-1}},{key:"focus",value:function(){this.dom.link.focus(),this.elements.parentMenu.isTopLevel&&(this.dom.link.tabIndex=0)}},{key:"blur",value:function(){this.dom.link.blur(),this.elements.parentMenu.isTopLevel&&(this.dom.link.tabIndex=-1)}},{key:"dom",get:function(){return this.domElements}},{key:"elements",get:function(){return this.menuElements}},{key:"isSubmenuItem",get:function(){return this.isController}}]),e}(),y=function(){function e(t){var n=t.menuElement,o=t.menuItemSelector,r=void 0===o?"li":o,u=t.menuLinkSelector,i=void 0===u?"a":u,a=t.submenuItemSelector,h=void 0===a?"":a,d=t.submenuToggleSelector,v=void 0===d?"a":d,p=t.submenuSelector,b=void 0===p?"ul":p,y=t.controllerElement,g=void 0===y?null:y,M=t.containerElement,C=void 0===M?null:M,E=t.openClass,w=void 0===E?"show":E,k=t.isTopLevel,I=void 0===k||k,S=t.parentMenu,T=void 0===S?null:S,L=t.isHoverable,A=void 0!==L&&L,O=t.hoverDelay,x=void 0===O?250:O;s(this,e),m({isTopLevel:I}),c(""!==h?{menuItemSelector:r,menuLinkSelector:i,submenuItemSelector:h,submenuToggleSelector:v,submenuSelector:b}:{menuItemSelector:r,menuLinkSelector:i}),l(null!==g||null!==C?{menuElement:n,controllerElement:g,containerElement:C}:{menuElement:n}),null!==T&&f({parentMenu:T}),this.domElements={menu:n,menuItems:Array.from(n.querySelectorAll(r)).filter((function(e){return e.parentElement===n})),submenuItems:Array.from(n.querySelectorAll(h)).filter((function(e){return e.parentElement===n})),submenuToggles:[],submenus:[],controller:g,container:C},this.domSelectors={menuItems:r,menuLinks:i,submenuItems:h,submenuToggles:v,submenus:b},this.menuElements={menuItems:[],submenuToggles:[],controller:null,parentMenu:T,rootMenu:I?this:null},this.openClass=w,this.root=I,this.currentChild=0,this.focusState="none",this.isHoverable=A,this.hoverDelay=x,this.initialize()}return i(e,[{key:"initialize",value:function(){if((this.dom.menu.setAttribute("role","menubar"),null===this.elements.rootMenu&&this.findRootMenu(this),this.createMenuItems(),this.handleKeydown(),this.handleClick(),this.isHoverable&&this.handleHover(),this.isTopLevel)&&(this.currentMenuItem.dom.link.tabIndex=0,this.handleFocus(),this.dom.controller&&this.dom.container)){var e=new p({menuToggleElement:this.dom.controller,parentElement:this.dom.container,controlledMenu:this,openClass:this.openClass});this.menuElements.controller=e}}},{key:"findRootMenu",value:function(e){if(e.isTopLevel)this.menuElements.rootMenu=e;else{if(null===e.elements.parentMenu)throw new Error("Cannot find root menu.");this.findRootMenu(e.elements.parentMenu)}}},{key:"createMenuItems",value:function(){var t=this;this.dom.menuItems.forEach((function(n){var o;if(t.dom.submenuItems.includes(n)){var r=n.querySelector(t.selectors.submenuToggles),s=new e({menuElement:n.querySelector(t.selectors.submenus),menuItemSelector:t.selectors.menuItems,menuLinkSelector:t.selectors.menuLinks,submenuItemSelector:t.selectors.submenuItems,submenuToggleSelector:t.selectors.submenuToggles,submenuSelector:t.selectors.submenus,openClass:t.openClass,isTopLevel:!1,parentMenu:t,isHoverable:t.isHoverable,hoverDelay:t.hoverDelay}),u=new p({menuToggleElement:r,parentElement:n,controlledMenu:s,openClass:t.openClass,parentMenu:t});t.menuElements.submenuToggles.push(u),o=new b({menuItemElement:n,menuLinkElement:r,parentMenu:t,isSubmenuItem:!0,childMenu:s,toggle:u})}else{var i=n.querySelector(t.selectors.menuLinks);o=new b({menuItemElement:n,menuLinkElement:i,parentMenu:t})}t.menuElements.menuItems.push(o)}))}},{key:"handleFocus",value:function(){var e=this;this.elements.menuItems.forEach((function(t){t.dom.link.addEventListener("focusin",(function(){"none"===e.focusState&&(e.focusState="self",e.focusCurrentChild())})),t.dom.link.addEventListener("focusout",(function(t){"none"===e.focusState&&(e.blur(t),e.closeChildren(t))}))}))}},{key:"handleKeydown",value:function(){var e=this;this.dom.menu.addEventListener("keydown",(function(t){var n=d(t),o=t.altKey,r=t.crtlKey,s=t.metaKey,u=o||r||s;if(e.isTopLevel){if("none"===e.focusState)"Space"!==n&&"Enter"!==n||(v(t),e.focusState="self",e.focusFirstChild());else if("self"===e.focusState)if("Space"===n||"Enter"===n)v(t),e.currentMenuItem.dom.link.click();else if("ArrowRight"===n){v(t);var i=e.currentMenuItem.isSubmenuItem&&e.currentMenuItem.elements.toggle.isOpen;e.focusNextChild(),i&&(e.currentMenuItem.isSubmenuItem?e.currentMenuItem.elements.toggle.preview(t):e.closeChildren(t))}else if("ArrowLeft"===n){v(t);var l=e.currentMenuItem.isSubmenuItem&&e.currentMenuItem.elements.toggle.isOpen;e.focusPreviousChild(),l&&(e.currentMenuItem.isSubmenuItem?e.currentMenuItem.elements.toggle.preview(t):e.closeChildren(t))}else"ArrowDown"===n?e.currentMenuItem.isSubmenuItem&&(v(t),e.currentMenuItem.elements.toggle.open(t),e.currentMenuItem.elements.childMenu.focusFirstChild()):"ArrowUp"===n?e.currentMenuItem.isSubmenuItem&&(v(t),e.currentMenuItem.elements.toggle.open(t),e.currentMenuItem.elements.childMenu.focusLastChild()):"Home"===n?(v(t),e.focusFirstChild()):"End"===n?(v(t),e.focusLastChild()):"Escape"===n&&null!==e.elements.controller&&e.elements.controller.close(t)}else"Space"===n||"Enter"===n?(v(t),e.currentMenuItem.dom.link.click()):"Escape"===n?(v(t),e.elements.rootMenu.closeChildren(t),e.elements.rootMenu.focusCurrentChild()):"ArrowRight"===n?e.currentMenuItem.isSubmenuItem?(v(t),e.currentMenuItem.elements.toggle.open(t)):(v(t),e.elements.rootMenu.closeChildren(t),e.elements.rootMenu.focusNextChild(),e.elements.rootMenu.currentMenuItem.isSubmenuItem&&e.elements.rootMenu.currentMenuItem.elements.toggle.preview(t)):"ArrowLeft"===n?e.elements.parentMenu.currentMenuItem.isSubmenuItem&&(v(t),e.elements.parentMenu.currentMenuItem.elements.toggle.close(t),e.elements.parentMenu===e.elements.rootMenu&&(e.elements.rootMenu.closeChildren(t),e.elements.rootMenu.focusPreviousChild(),e.elements.rootMenu.currentMenuItem.isSubmenuItem&&e.elements.rootMenu.currentMenuItem.elements.toggle.preview(t))):"ArrowDown"===n?(v(t),e.focusNextChild()):"ArrowUp"===n?(v(t),e.focusPreviousChild()):"Home"===n?(v(t),e.focusFirstChild()):"End"===n&&(v(t),e.focusLastChild());"Character"!==n||u||(v(t),e.focusNextChildWithCharacter(t.key)),"none"!==e.focusState&&"Tab"===n&&(e.elements.rootMenu.blur(t),e.elements.rootMenu.closeChildren(t))}))}},{key:"handleClick",value:function(){var e=this;document.addEventListener("click",(function(t){"none"!==e.focusState&&(e.dom.menu.contains(t.target)||!e.dom.menu===t.target||(e.closeChildren(t),e.blur(t),e.elements.controller&&e.elements.controller.close(t)))})),this.elements.menuItems.forEach((function(t){t.dom.link.addEventListener("click",(function(){e.currentChild=e.elements.menuItems.indexOf(t)}))}))}},{key:"handleHover",value:function(){var e=this;this.elements.submenuToggles.forEach((function(t){t.dom.parent.addEventListener("mouseenter",(function(){t.open()})),t.dom.parent.addEventListener("mouseleave",(function(){setTimeout((function(){t.close()}),e.hoverDelay)}))}))}},{key:"focus",value:function(){this.focusState="self",this.dom.menu.focus()}},{key:"blur",value:function(e){this.focusState="none",this.dom.menu.blur(),this.isTopLevel&&this.elements.controller&&this.elements.controller.close(e)}},{key:"focusFirstChild",value:function(){this.blurCurrentChild(),this.currentChild=0,this.focusCurrentChild()}},{key:"focusLastChild",value:function(){this.blurCurrentChild(),this.currentChild=this.elements.menuItems.length-1,this.focusCurrentChild()}},{key:"focusNextChild",value:function(){this.currentChild===this.elements.menuItems.length-1?this.focusFirstChild():(this.blurCurrentChild(),this.currentChild=this.currentChild+1,this.focusCurrentChild())}},{key:"focusPreviousChild",value:function(){0===this.currentChild?this.focusLastChild():(this.blurCurrentChild(),this.currentChild=this.currentChild-1,this.focusCurrentChild())}},{key:"focusCurrentChild",value:function(){-1!==this.currentChild&&this.currentMenuItem.focus()}},{key:"blurCurrentChild",value:function(){-1!==this.currentChild&&this.currentMenuItem.blur()}},{key:"focusNextChildWithCharacter",value:function(e){for(var t=e.toLowerCase(),n=this.currentChild+1,o=!1;!o&&n<this.elements.menuItems.length;){this.elements.menuItems[n].dom.item.innerText.toLowerCase().startsWith(t)&&(o=!0,this.currentChild=n,this.focusCurrentChild()),n++}}},{key:"focusController",value:function(){this.dom.controller&&(this.dom.controller.focus(),this.focusState="none")}},{key:"focusContainer",value:function(){this.dom.container&&(this.dom.container.focus(),this.focusState="none")}},{key:"closeChildren",value:function(e){this.elements.submenuToggles.forEach((function(t){return t.close(e)}))}},{key:"dom",get:function(){return this.domElements}},{key:"selectors",get:function(){return this.domSelectors}},{key:"elements",get:function(){return this.menuElements}},{key:"openClass",get:function(){return this.submenuOpenClass},set:function(e){h({value:e}),this.submenuOpenClass=e}},{key:"isTopLevel",get:function(){return this.root}},{key:"currentChild",get:function(){return this.focussedChild},set:function(e){a({value:e}),this.focussedChild=e}},{key:"focusState",get:function(){return this.state},set:function(e){!function(e){h(e);var t=["none","self","child"],n="value";try{if("object"!==r(e)){if(t.includes(e))return!0;throw Error}for(var o in e)if(n=o,!t.includes(e[o]))throw Error}catch(e){throw new Error("".concat(n," must be one of the following values: ").concat(t.join(", ")))}}({value:e}),this.state=e}},{key:"currentMenuItem",get:function(){return this.elements.menuItems[this.currentChild]}},{key:"isHoverable",get:function(){return this.hoverable},set:function(e){m({value:e}),this.hoverable=e}},{key:"hoverDelay",get:function(){return this.delay},set:function(e){a({value:e}),this.delay=e}}]),e}();return y}();
