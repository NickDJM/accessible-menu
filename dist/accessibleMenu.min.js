"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var AccessibleMenu=function(){var e={menuItemElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuItemElement must be an HTML Element.")},parentMenu:function(e){if(!(e instanceof i))throw new TypeError("parentMenu must be a Menu.")}},t=function(){function t(n,s){_classCallCheck(this,t),e.menuItemElement(n),e.parentMenu(s),this.domElements={menuItem:n,link:n.querySelector("a")},this.elements={parent:s}}return _createClass(t,[{key:"initialize",value:function(){this.element.setAttribute("role","menuitem"),this.link.tabIndex=-1}},{key:"focus",value:function(){this.element.querySelector("a").focus()}},{key:"element",get:function(){return this.domElements.menuItem}},{key:"link",get:function(){return this.domElements.link}},{key:"parentMenu",get:function(){return this.elements.parent}}]),t}(),n={menuToggleElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuToggleElement must be an HTML Element.")},menu:function(e){if(!(e instanceof i))throw new TypeError("menu must be a Menu.")},openClass:function(e){if("string"!=typeof e)throw TypeError("openClass must be a string.");if(e.replace(/[_a-zA-Z0-9-]/g,"").length>0)throw Error("openClass must be a valid CSS class.")},parentMenu:function(e){if(null!==e&&!(e instanceof i))throw new TypeError("parentMenu must be a Menu.")},parentMenuItem:function(e){if(null!==e&&!(e instanceof t))throw new TypeError("parentMenuItem must be a MenuItem.")},rootMenu:function(e){if(null!==e&&!(e instanceof i))throw new TypeError("rootMenu must be a Menu.")}},s=function(){function e(t,s){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"show",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;_classCallCheck(this,e),n.menuToggleElement(t),n.menu(s),n.openClass(u),n.parentMenu(i),n.parentMenuItem(o),n.rootMenu(r),this.domElements={toggle:t},this.elements={menuItem:o,menu:s,parentMenu:i,rootMenu:r||i},this.openClass=u}return _createClass(e,[{key:"initialize",value:function(){var e=this;if(this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"),this.element.setAttribute("role","button"),""===this.element.id||""===this.menu.element.id){var t=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10),n="".concat(this.element.innerText.toLowerCase().replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s/g,"-"),"-").concat(t);this.element.id=this.element.id||"".concat(n,"-menu-button"),this.menu.element.id=this.menu.element.id||"".concat(n,"-menu")}this.menu.element.setAttribute("aria-labelledby",this.element.id),this.element.setAttribute("aria-controls",this.menu.element.id),this.element.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.toggle()})),this.handleKeydown()}},{key:"open",value:function(){this.isOpen||(this.isOpen=!0,this.element.setAttribute("aria-expanded","true"),this.menuItem.element.classList.add(this.openClass),this.menu.element.classList.add(this.openClass),this.closeSiblings(),this.parentMenu.currentFocus="child",this.menu.currentFocus="self",this.menu.focusFirstChild())}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.element.setAttribute("aria-expanded","false"),this.menuItem.element.classList.remove(this.openClass),this.menu.element.classList.remove(this.openClass),this.closeChildren(),this.menu.currentFocus="none",this.parentMenu.currentFocus="self",this.parentMenu.focusCurrentChild())}},{key:"toggle",value:function(){this.isOpen?this.close():this.open()}},{key:"closeSiblings",value:function(){var e=this;try{this.parentMenu.menuToggles.forEach((function(t){t!==e&&t.close()}))}catch(e){}}},{key:"closeChildren",value:function(){this.menu.menuToggles.forEach((function(e){return e.close()}))}},{key:"handleKeydown",value:function(){var e=this;function t(e){e.preventDefault(),e.stopPropagation()}this.menu.element.addEventListener("keydown",(function(n){var s=n.key;"Escape"===s?(t(n),e.close()):e.parentMenu.isTopLevel&&"ArrowRight"===s?(t(n),e.close(),e.parentMenu.focusNextChild()):e.parentMenu.isTopLevel&&"ArrowLeft"===s&&(t(n),e.close(),e.parentMenu.focusPreviousChild())})),this.menuItem.element.addEventListener("keydown",(function(n){var s=n.key;"none"===e.menu.currentFocus&&e.parentMenu.isTopLevel&&("ArrowUp"===s?(t(n),e.open(),e.menu.focusLastChild()):"ArrowDown"===s&&(t(n),e.open()))}))}},{key:"element",get:function(){return this.domElements.toggle}},{key:"menuItem",get:function(){return this.elements.menuItem}},{key:"menu",get:function(){return this.elements.menu}},{key:"parentMenu",get:function(){return this.elements.parentMenu}},{key:"rootMenu",get:function(){return this.elements.rootMenu}},{key:"isOpen",get:function(){return this.show},set:function(e){if("boolean"!=typeof e)throw new TypeError("Open state must be true or false.");this.show=e}}]),e}(),u={menuElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuElement must be an HTML Element.")},menuItemSelector:function(e){if("string"!=typeof e)throw new TypeError("menuItemSelector must be a CSS selector string.")},submenuItemSelector:function(e){if("string"!=typeof e)throw new TypeError("submenuItemSelector must be a CSS selector string.")},submenuToggleSelector:function(e){if("string"!=typeof e)throw new TypeError("submenuToggleSelector must be a CSS selector string.")},submenuSelector:function(e){if("string"!=typeof e)throw new TypeError("submenuSelector must be a CSS selector string.")},submenuOpenClass:function(e){if("string"!=typeof e)throw TypeError("submenuOpenClass must be a string.");if(e.replace(/[_a-zA-Z0-9-]/g,"").length>0)throw Error("submenuOpenClass must be a valid CSS class.")},isTopLevel:function(e){if("boolean"!=typeof e)throw new TypeError("isTopLevel must be true or false")}},i=function(){function e(t,n,s,i,o){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"show",l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];_classCallCheck(this,e),u.menuElement(t),u.menuItemSelector(n),u.submenuItemSelector(s),u.submenuToggleSelector(i),u.submenuSelector(o),u.submenuOpenClass(r),u.isTopLevel(l),this.domElements={menu:t,menuItems:Array.from(t.querySelectorAll(n)).filter((function(e){return e.parentElement===t})),submenuItems:Array.from(t.querySelectorAll(s)).filter((function(e){return e.parentElement===t}))},this.domSelectors={"menu-items":n,"submenu-items":s,"submenu-toggle":i,submenu:o},this.elements={menuItems:[],menuToggles:[]},this.focussedChild=-1,this.focusState="none",this.openClass=r,this.root=l}return _createClass(e,[{key:"initialize",value:function(){this.element.setAttribute("role","menu"),this.element.tabIndex=0,this.createMenuItems(),this.handleKeydown(),this.handleClick()}},{key:"createMenuItems",value:function(){var n=this;this.menuItemElements.forEach((function(u){var i=new t(u,n);if(n.elements.menuItems.push(i),i.initialize(),n.submenuItemElements.includes(u)){var o=u.querySelector(n.selector["submenu-toggle"]),r=new e(u.querySelector(n.selector.submenu),n.selector["menu-items"],n.selector["submenu-items"],n.selector["submenu-toggle"],n.selector.submenu,n.openClass,!1);r.initialize();var l=new s(o,r,n.openClass,n,i);l.initialize(),n.elements.menuToggles.push(l)}}))}},{key:"handleKeydown",value:function(){var e=this;function t(e){e.preventDefault(),e.stopPropagation()}this.element.addEventListener("keydown",(function(n){var s=n.key,u=n.code,i=n.altKey,o=n.crtlKey,r=n.metaKey,l=i||o||r;"none"===e.currentFocus?("Enter"===s||" "===s&&"Space"===u)&&(t(n),e.currentFocus="self",e.focusFirstChild()):"self"===e.currentFocus&&("Escape"===s?(t(n),e.focus(),e.currentFocus="none"):e.isTopLevel||"ArrowUp"!==s?e.isTopLevel&&"ArrowRight"===s?(t(n),e.focusNextChild()):e.isTopLevel||"ArrowDown"!==s?e.isTopLevel&&"ArrowLeft"===s?(t(n),e.focusPreviousChild()):"Home"===s?(t(n),e.focusFirstChild()):"End"===s?(t(n),e.focusLastChild()):s.match(/^[a-zA-Z]{1}$/)&&!l&&(t(n),e.focusNextChildWithCharacter(s)):(t(n),e.focusNextChild()):(t(n),e.focusPreviousChild())),"none"!==e.currentFocus&&"Tab"===s&&(e.blur(),e.closeChildren())}))}},{key:"handleClick",value:function(){var e=this;document.addEventListener("click",(function(t){e.element.contains(t.target)||e.element===t.target||(e.blur(),e.closeChildren())}))}},{key:"focus",value:function(){this.focussedChild=0,this.currentFocus="self",this.element.focus()}},{key:"blur",value:function(){this.focussedChild=-1,this.currentFocus="none",this.element.blur()}},{key:"focusFirstChild",value:function(){this.focussedChild=0,this.focusCurrentChild()}},{key:"focusLastChild",value:function(){this.focussedChild=this.menuItems.length-1,this.focusCurrentChild()}},{key:"focusNextChild",value:function(){this.focussedChild===this.menuItems.length-1?this.focusFirstChild():(this.focussedChild=this.focussedChild+1,this.focusCurrentChild())}},{key:"focusPreviousChild",value:function(){0===this.focussedChild?this.focusLastChild():(this.focussedChild=this.focussedChild-1,this.focusCurrentChild())}},{key:"focusCurrentChild",value:function(){-1!==this.focussedChild&&this.menuItems[this.focussedChild].focus()}},{key:"focusNextChildWithCharacter",value:function(e){for(var t=e.toLowerCase(),n=this.focussedChild+1,s=!1;!s&&n<this.menuItems.length;){this.menuItems[n].element.innerText.toLowerCase().startsWith(t)&&(s=!0,this.focussedChild=n,this.focusCurrentChild()),n++}}},{key:"closeChildren",value:function(){this.menuToggles.forEach((function(e){return e.close()}))}},{key:"element",get:function(){return this.domElements.menu}},{key:"menuItemElements",get:function(){return this.domElements.menuItems}},{key:"submenuItemElements",get:function(){return this.domElements.submenuItems}},{key:"menuItems",get:function(){return this.elements.menuItems}},{key:"menuToggles",get:function(){return this.elements.menuToggles}},{key:"selector",get:function(){return this.domSelectors}},{key:"currentFocus",get:function(){return this.focusState},set:function(e){if(!["self","child","none"].includes(e))throw new Error("Focus state must be 'self', 'child', or 'none'.");this.focusState=e}},{key:"openClass",get:function(){return this.submenuOpenClass},set:function(e){if("string"!=typeof e)throw new TypeError("Class must be a string.");this.submenuOpenClass=e}},{key:"isTopLevel",get:function(){return this.root},set:function(e){if("boolean"!=typeof e)throw new TypeError("Top-level flag must be true or false.");this.root=e}}]),e}();return i}();