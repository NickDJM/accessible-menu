"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var AccessibleMenu=function(){var e={event:function(e){if(!(e instanceof Event))throw new TypeError("event must be an event.")},keyboardEvent:function(e){if(!(e instanceof KeyboardEvent))throw new TypeError("event must be a keyboard event.")}};function t(t){e.keyboardEvent(t);try{var n=t.key||t.keyCode,r={Enter:"Enter"===n||13===n,Space:" "===n||"Spacebar"===n||32===n,Escape:"Escape"===n||"Esc"===n||27===n,ArrowUp:"ArrowUp"===n||"Up"===n||38===n,ArrowRight:"ArrowRight"===n||"Right"===n||39===n,ArrowDown:"ArrowDown"===n||"Down"===n||40===n,ArrowLeft:"ArrowLeft"===n||"Left"===n||37===n,Home:"Home"===n||36===n,End:"End"===n||35===n,Character:!!n.match(/^[a-zA-Z]{1}$/),Tab:"Tab"===n||9===n};return Object.keys(r).find((function(e){return!0===r[e]}))}catch(e){return""}}function n(t){e.event(t),t.preventDefault(),t.stopPropagation()}var r={menuToggleElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuToggleElement must be an HTML Element.")},parentElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("parentElement must be an HTML Element.")},menu:function(e){if(!(e instanceof f))throw new TypeError("menu must be a Menu.")},openClass:function(e){if("string"!=typeof e)throw TypeError("openClass must be a string.");if(e.replace(/[_a-zA-Z0-9-]/g,"").length>0)throw Error("openClass must be a valid CSS class.")},parentMenu:function(e){if(null!==e&&!(e instanceof f))throw new TypeError("parentMenu must be a Menu.")}},o=function(){function e(t){var n=t.menuToggleElement,o=t.parentElement,s=t.menu,u=t.openClass,i=void 0===u?"show":u,l=t.parentMenu,c=void 0===l?null:l;_classCallCheck(this,e),r.menuToggleElement(n),r.parentElement(o),r.menu(s),r.openClass(i),r.parentMenu(c),this.domElements={toggle:n,parent:o},this.elements={menu:s,parentMenu:c},this.openClass=i}return _createClass(e,[{key:"initialize",value:function(){if(this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"),this.element.setAttribute("role","button"),""===this.element.id||""===this.menu.element.id){var e=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10),t="".concat(this.element.innerText.toLowerCase().replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s/g,"-"),"-").concat(e);this.element.id=this.element.id||"".concat(t,"-menu-button"),this.menu.element.id=this.menu.element.id||"".concat(t,"-menu")}this.menu.element.setAttribute("aria-labelledby",this.element.id),this.element.setAttribute("aria-controls",this.menu.element.id),this.handleClick()}},{key:"open",value:function(){this.isOpen||(this.isOpen=!0,this.element.setAttribute("aria-expanded","true"),this.parentElement.classList.add(this.openClass),this.menu.element.classList.add(this.openClass),this.closeSiblings(),this.parentMenu&&(this.parentMenu.currentFocus="child"),this.menu.currentFocus="self",this.menu.focusFirstChild())}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.element.setAttribute("aria-expanded","false"),this.parentElement.classList.remove(this.openClass),this.menu.element.classList.remove(this.openClass),this.closeChildren(),this.menu.currentFocus="none",this.parentMenu?(this.parentMenu.currentFocus="self",this.parentMenu.focusCurrentChild()):this.menu.isTopLevel&&this.menu.focusController())}},{key:"toggle",value:function(){this.isOpen?this.close():this.open()}},{key:"closeSiblings",value:function(){var e=this;try{this.parentMenu.menuToggles.forEach((function(t){t!==e&&t.close()}))}catch(e){}}},{key:"closeChildren",value:function(){this.menu.menuToggles.forEach((function(e){return e.close()}))}},{key:"handleClick",value:function(){var e=this;this.element.addEventListener("click",(function(t){n(t),e.toggle()}))}},{key:"element",get:function(){return this.domElements.toggle}},{key:"parentElement",get:function(){return this.domElements.parent}},{key:"menu",get:function(){return this.elements.menu}},{key:"parentMenu",get:function(){return this.elements.parentMenu}},{key:"isOpen",get:function(){return this.show},set:function(e){if("boolean"!=typeof e)throw new TypeError("Open state must be true or false.");this.show=e}}]),e}(),s={childMenu:function(e){if(!(e instanceof l))throw new TypeError("childMenu must be a Submenu.")},toggle:function(e){if(!(e instanceof o))throw new TypeError("toggle must be a MenuToggle.")}},u=function(e){function t(e){var n,r=e.menuItemElement,o=e.parentMenu,u=e.childMenu,i=e.toggle;return _classCallCheck(this,t),s.childMenu(u),s.toggle(i),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,{menuItemElement:r,parentMenu:o}))).elements=_objectSpread({},n.elements,{childMenu:u,toggle:i}),n}return _inherits(t,e),_createClass(t,[{key:"linkElement",get:function(){return this.toggle.element}},{key:"childMenu",get:function(){return this.elements.childMenu}},{key:"toggle",get:function(){return this.elements.toggle}}]),t}(a),i={parentMenu:function(e){if(!(e instanceof f||e instanceof l))throw new TypeError("parentMenu must be either a Menu or a Submenu.")}},l=function(e){function r(e){var t,n=e.menuElement,o=e.menuItemSelector,s=e.submenuItemSelector,u=e.submenuToggleSelector,l=e.submenuSelector,c=e.openClass,a=e.parentMenu;return _classCallCheck(this,r),i.parentMenu(a),(t=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,{menuElement:n,menuItemSelector:o,submenuItemSelector:s,submenuToggleSelector:u,submenuSelector:l,openClass:c}))).elements=_objectSpread({},t.elements,{parentMenu:a}),t}return _inherits(r,e),_createClass(r,[{key:"initialize",value:function(){this.findRootMenu(this.parentMenu),_get(_getPrototypeOf(r.prototype),"initialize",this).call(this),this.element.setAttribute("aria-rolle","menu")}},{key:"findRootMenu",value:function(e){if(e instanceof f)this.rootMenu=this.parentMenu;else{if(!(e instanceof r))throw new TypeError("menu must be a Menu or a Submenu");this.findRootMenu(e.parentMenu)}}},{key:"handleKeydown",value:function(){var e=this;this.currentMenuItem.linkElement.addEventListener("keydown",(function(r){var o=t(r),s=r.altKey,i=r.crtlKey,l=r.metaKey,c=s||i||l;"self"===e.currentFocus&&("Space"===o||"Enter"===o?(n(r),e.currentMenuItem.linkElement.click()):"Escape"===o?(n(r),e.rootMenu.closeChildren(),e.rootMenu.focusCurrentChild()):"ArrowRight"===o?(n(r),e.currentMenuItem instanceof u?e.currentMenuItem.toggle.open():(e.rootMenu.closeChildren(),e.rootMenu.focusNextChild(),e.rootMenu.currentMenuItem instanceof u&&(e.rootMenu.currentMenuItem.toggle.open(),e.rootMenu.currentMenuItem.childMenu.focus()))):"ArrowLeft"===o?(n(r),e.currentMenuItem instanceof u&&(e.currentMenuItem.toggle.close(),e.parentMenu===e.rootMenu&&(e.rootMenu.closeChildren(),e.rootMenu.focusPreviousChild(),e.rootMenu.currentMenuItem instanceof u&&(e.rootMenu.currentMenuItem.toggle.open(),e.rootMenu.currentMenuItem.childMenu.focus())))):"ArrowDown"===o?(n(r),e.focusNextChild()):"ArrowUp"===o?(n(r),e.focusPreviousChild()):"Home"===o?(n(r),e.focusFirstChild()):"End"===o?(n(r),e.focusLastChild()):"Character"!==o||c||(n(r),e.focusNextChildWithCharacter(r.key)))}))}},{key:"parentMenu",get:function(){return this.elements.parentMenu}},{key:"rootMenu",get:function(){return this.elements.rootMenu},set:function(e){if(!(e instanceof f))throw new TypeError("menu must be a Menu.");this.elements.rootMenu=e}}]),r}(f),c={menuItemElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuItemElement must be an HTML Element.")},parentMenu:function(e){if(!(e instanceof f||e instanceof l))throw new TypeError("parentMenu must be a Menu or a Submenu.")}},a=function(){function e(t){var n=t.menuItemElement,r=t.parentMenu;_classCallCheck(this,e),c.menuItemElement(n),c.parentMenu(r),this.domElements={menuItem:n,link:n.querySelector("a")},this.elements={parentMenu:r}}return _createClass(e,[{key:"initialize",value:function(){this.element.setAttribute("role","menuitem"),this.linkElement.tabIndex=-1}},{key:"focus",value:function(){this.linkElement.focus()}},{key:"blur",value:function(){this.linkElement.blur()}},{key:"element",get:function(){return this.domElements.menuItem}},{key:"linkElement",get:function(){return this.domElements.link}},{key:"parentMenu",get:function(){return this.elements.parentMenu}}]),e}(),m={menuElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuElement must be an HTML Element.")},menuItemSelector:function(e){if("string"!=typeof e)throw new TypeError("menuItemSelector must be a CSS selector string.")},hasSubmenus:function(e,t,n){if(null!==e||null!==t||null!==n){if("string"!=typeof e)throw new TypeError("submenuItemSelector must be a CSS selector string.");if("string"!=typeof e)throw new TypeError("submenuToggleSelector must be a CSS selector string.");if("string"!=typeof n)throw new TypeError("submenuSelector must be a CSS selector string.")}},openClass:function(e){if("string"!=typeof e)throw TypeError("openClass must be a string.");if(e.replace(/[_a-zA-Z0-9-]/g,"").length>0)throw Error("openClass must be a valid CSS class.")},isDropdown:function(e,t){if(null!==e||null!==t){if(!(e instanceof HTMLElement))throw new TypeError("controllerElement must be an HTML Element if containerElement is provided.");if(!(t instanceof HTMLElement))throw new TypeError("containerElement must be an HTML Element if controllerElement is provided.")}}},f=function(){function e(t){var n=t.menuElement,r=t.menuItemSelector,o=t.submenuItemSelector,s=void 0===o?null:o,u=t.submenuToggleSelector,i=void 0===u?null:u,l=t.submenuSelector,c=void 0===l?null:l,a=t.openClass,f=void 0===a?"show":a,h=t.controllerElement,p=void 0===h?null:h,d=t.containerElement,y=void 0===d?null:d;_classCallCheck(this,e),m.menuElement(n),m.menuItemSelector(r),m.hasSubmenus(s,i,c),m.openClass(f),m.isDropdown(p,y),this.domElements={menu:n,controller:p,container:y,menuItems:Array.from(n.querySelectorAll(r)).filter((function(e){return e.parentElement===n})),submenuItems:Array.from(n.querySelectorAll(s)).filter((function(e){return e.parentElement===n}))},this.domSelectors={"menu-items":r,"submenu-items":s,"submenu-toggle":i,submenu:c},this.elements={menuItems:[],menuToggles:[],controller:null},this.focussedChild=-1,this.focusState="none",this.openClass=f}return _createClass(e,[{key:"initialize",value:function(){if(this.element.setAttribute("role","menubar"),this.element.tabIndex=0,this.createMenuItems(),this.handleKeydown(),this.handleClick(),this.controllerElement&&this.containerElement){var e=new o({menuToggleElement:this.controllerElement,parentElement:this.containerElement,menu:this,openClass:this.openClass});e.initialize(),this.elements.controller=e}}},{key:"createMenuItems",value:function(){var e=this;this.menuItemElements.forEach((function(t){var n;if(e.submenuItemElements.includes(t)){var r=t.querySelector(e.selector["submenu-toggle"]),s=t.querySelector(e.selector.submenu),i=new l({menuElement:s,menuItemSelector:e.selector["menu-items"],submenuItemSelector:e.selector["submenu-items"],submenuToggleSelector:e.selector["submenu-toggle"],submenuSelector:e.selector.submenu,submenuOpenClass:e.openClass,parentMenu:e});i.initialize();var c=new o({menuToggleElement:r,parentElement:t,menu:i,openClass:e.openClass,parentMenu:e});c.initialize(),e.elements.menuToggles.push(c),n=new u({menuItemElement:t,parentMenu:e,childMenu:i,toggle:c})}else n=new a({menuItemElement:t,parentMenu:e});n.initialize(),e.elements.menuItem.push(n)}))}},{key:"handleKeydown",value:function(){var e=this;this.element.addEventListener("keydown",(function(r){var o=t(r),s=r.altKey,i=r.crtlKey,l=r.metaKey,c=s||i||l;"none"===e.currentFocus?"Space"!==o&&"Enter"!==o||(n(r),e.currentFocus="self",e.focusFirstChild()):"self"===e.currentFocus&&("RightArrow"===o?(n(r),e.focusNextChild()):"LeftArrow"===o?(n(r),e.focusPreviousChild()):"DownArrow"===o?e.currentMenuItem instanceof u&&(e.currentMenuItem.toggle.open(),e.currentMenuItem.childMenu.focusFirstChild()):"UpArrow"===o?e.currentMenuItem instanceof u&&(e.currentMenuItem.toggle.open(),e.currentMenuItem.childMenu.focusLastChild()):"Home"===o?(n(r),e.focusFirstChild()):"End"===o?(n(r),e.focusLastChild()):"Character"!==o||c||(n(r),e.focusNextChildWithCharacter(r.key))),"none"!==e.currentFocus&&"Tab"===o&&(e.blur(),e.closeChildren())}))}},{key:"handleClick",value:function(){var e=this;document.addEventListener("click",(function(t){e.element.contains(t.target)||e.element===t.target||(e.blur(),e.closeChildren(),e.controller&&e.controller.close())}))}},{key:"focus",value:function(){this.focussedChild=0,this.currentFocus="self",this.element.focus()}},{key:"blur",value:function(){this.focussedChild=-1,this.currentFocus="none",this.element.blur()}},{key:"focusFirstChild",value:function(){this.focussedChild=0,this.focusCurrentChild()}},{key:"focusLastChild",value:function(){this.focussedChild=this.menuItems.length-1,this.focusCurrentChild()}},{key:"focusNextChild",value:function(){this.focussedChild===this.menuItems.length-1?this.focusFirstChild():(this.focussedChild=this.focussedChild+1,this.focusCurrentChild())}},{key:"focusPreviousChild",value:function(){0===this.focussedChild?this.focusLastChild():(this.focussedChild=this.focussedChild-1,this.focusCurrentChild())}},{key:"focusCurrentChild",value:function(){-1!==this.focussedChild&&this.menuItems[this.focussedChild].focus()}},{key:"focusNextChildWithCharacter",value:function(e){for(var t=e.toLowerCase(),n=this.focussedChild+1,r=!1;!r&&n<this.menuItems.length;){this.menuItems[n].element.innerText.toLowerCase().startsWith(t)&&(r=!0,this.focussedChild=n,this.focusCurrentChild()),n++}}},{key:"focusController",value:function(){this.controllerElement&&(this.controllerElement.focus(),this.currentFocus="none")}},{key:"focusContainer",value:function(){this.containerElement&&(this.containerElement.focus(),this.currentFocus="none")}},{key:"closeChildren",value:function(){this.menuToggles.forEach((function(e){return e.close()}))}},{key:"element",get:function(){return this.domElements.menu}},{key:"controllerElement",get:function(){return this.domElements.controller}},{key:"containerElement",get:function(){return this.domElements.container}},{key:"menuItemElements",get:function(){return this.domElements.menuItems}},{key:"submenuItemElements",get:function(){return this.domElements.submenuItems}},{key:"menuItems",get:function(){return this.elements.menuItems}},{key:"menuToggles",get:function(){return this.elements.menuToggles}},{key:"controller",get:function(){return this.elements.controller}},{key:"selector",get:function(){return this.domSelectors}},{key:"currentFocus",get:function(){return this.focusState},set:function(e){if(!["self","child","none"].includes(e))throw new Error("Focus state must be 'self', 'child', or 'none'.");this.focusState=e}},{key:"openClass",get:function(){return this.submenuOpenClass},set:function(e){if("string"!=typeof e)throw new TypeError("Class must be a string.");this.submenuOpenClass=e}},{key:"currentMenuItem",get:function(){return this.menuItems[this.focussedChild]}}]),e}();return f}();