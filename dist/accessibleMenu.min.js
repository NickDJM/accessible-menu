"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var AccessibleMenu=function(){var e={menuItemElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuItemElement must be an HTML Element.")},parentMenu:function(e){if(!(e instanceof o))throw new TypeError("parentMenu must be a Menu.")}},t=function(){function t(n){var s=n.menuItemElement,i=n.parentMenu;_classCallCheck(this,t),e.menuItemElement(s),e.parentMenu(i),this.domElements={menuItem:s,link:s.querySelector("a")},this.elements={parent:i}}return _createClass(t,[{key:"initialize",value:function(){this.element.setAttribute("role","menuitem"),this.link.tabIndex=-1}},{key:"focus",value:function(){this.element.querySelector("a").focus()}},{key:"element",get:function(){return this.domElements.menuItem}},{key:"link",get:function(){return this.domElements.link}},{key:"parentMenu",get:function(){return this.elements.parent}}]),t}(),n={menuToggleElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuToggleElement must be an HTML Element.")},parentElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("parentElement must be an HTML Element.")},menu:function(e){if(!(e instanceof o))throw new TypeError("menu must be a Menu.")},openClass:function(e){if("string"!=typeof e)throw TypeError("openClass must be a string.");if(e.replace(/[_a-zA-Z0-9-]/g,"").length>0)throw Error("openClass must be a valid CSS class.")},parentMenu:function(e){if(null!==e&&!(e instanceof o))throw new TypeError("parentMenu must be a Menu.")}},s=function(){function e(t){var s=t.menuToggleElement,i=t.parentElement,o=t.menu,u=t.openClass,r=void 0===u?"show":u,l=t.parentMenu,m=void 0===l?null:l;_classCallCheck(this,e),n.menuToggleElement(s),n.parentElement(i),n.menu(o),n.openClass(r),n.parentMenu(m),this.domElements={toggle:s,menuItem:i},this.elements={menu:o,parentMenu:m},this.openClass=r}return _createClass(e,[{key:"initialize",value:function(){var e=this;if(this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"),this.element.setAttribute("role","button"),""===this.element.id||""===this.menu.element.id){var t=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10),n="".concat(this.element.innerText.toLowerCase().replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s/g,"-"),"-").concat(t);this.element.id=this.element.id||"".concat(n,"-menu-button"),this.menu.element.id=this.menu.element.id||"".concat(n,"-menu")}this.menu.element.setAttribute("aria-labelledby",this.element.id),this.element.setAttribute("aria-controls",this.menu.element.id),this.element.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.toggle()})),this.handleKeydown()}},{key:"open",value:function(){this.isOpen||(this.isOpen=!0,this.element.setAttribute("aria-expanded","true"),this.menuItemElement.classList.add(this.openClass),this.menu.element.classList.add(this.openClass),this.closeSiblings(),this.parentMenu&&(this.parentMenu.currentFocus="child"),this.menu.currentFocus="self",this.menu.focusFirstChild())}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.element.setAttribute("aria-expanded","false"),this.menuItemElement.classList.remove(this.openClass),this.menu.element.classList.remove(this.openClass),this.closeChildren(),this.menu.currentFocus="none",this.parentMenu&&(this.parentMenu.currentFocus="self"),this.parentMenu&&this.parentMenu.focusCurrentChild())}},{key:"toggle",value:function(){this.isOpen?this.close():this.open()}},{key:"closeSiblings",value:function(){var e=this;try{this.parentMenu.menuToggles.forEach((function(t){t!==e&&t.close()}))}catch(e){}}},{key:"closeChildren",value:function(){this.menu.menuToggles.forEach((function(e){return e.close()}))}},{key:"handleKeydown",value:function(){var e=this;function t(e){e.preventDefault(),e.stopPropagation()}this.menu.element.addEventListener("keydown",(function(n){var s=n.key;"Escape"===s?(t(n),e.close()):e.parentMenu&&e.parentMenu.isTopLevel&&("ArrowRight"===s?(t(n),e.close(),e.parentMenu.focusNextChild()):"ArrowLeft"===s&&(t(n),e.close(),e.parentMenu.focusPreviousChild()))})),this.menuItemElement.addEventListener("keydown",(function(n){var s=n.key;"none"===e.menu.currentFocus&&e.parentMenu.isTopLevel&&("ArrowUp"===s?(t(n),e.open(),e.menu.focusLastChild()):"ArrowDown"===s&&(t(n),e.open()))}))}},{key:"element",get:function(){return this.domElements.toggle}},{key:"menuItemElement",get:function(){return this.domElements.menuItem}},{key:"menu",get:function(){return this.elements.menu}},{key:"parentMenu",get:function(){return this.elements.parentMenu}},{key:"isOpen",get:function(){return this.show},set:function(e){if("boolean"!=typeof e)throw new TypeError("Open state must be true or false.");this.show=e}}]),e}(),i={menuElement:function(e){if(!(e instanceof HTMLElement))throw new TypeError("menuElement must be an HTML Element.")},menuItemSelector:function(e){if("string"!=typeof e)throw new TypeError("menuItemSelector must be a CSS selector string.")},submenuItemSelector:function(e){if("string"!=typeof e)throw new TypeError("submenuItemSelector must be a CSS selector string.")},submenuToggleSelector:function(e){if("string"!=typeof e)throw new TypeError("submenuToggleSelector must be a CSS selector string.")},submenuSelector:function(e){if("string"!=typeof e)throw new TypeError("submenuSelector must be a CSS selector string.")},submenuOpenClass:function(e){if("string"!=typeof e)throw TypeError("submenuOpenClass must be a string.");if(e.replace(/[_a-zA-Z0-9-]/g,"").length>0)throw Error("submenuOpenClass must be a valid CSS class.")},isTopLevel:function(e){if("boolean"!=typeof e)throw new TypeError("isTopLevel must be true or false")},isDropdown:function(e,t){if(null!==e||null!==t){if(!(e instanceof HTMLElement))throw new TypeError("controllerElement must be an HTML Element if containerElement is provided.");if(!(t instanceof HTMLElement))throw new TypeError("containerElement must be an HTML Element if controllerElement is provided.")}}},o=function(){function e(t){var n=t.menuElement,s=t.menuItemSelector,o=t.submenuItemSelector,u=t.submenuToggleSelector,r=t.submenuSelector,l=t.submenuOpenClass,m=void 0===l?"show":l,c=t.isTopLevel,a=void 0===c||c,h=t.controllerElement,f=void 0===h?null:h,p=t.containerElement,d=void 0===p?null:p;_classCallCheck(this,e),i.menuElement(n),i.menuItemSelector(s),i.submenuItemSelector(o),i.submenuToggleSelector(u),i.submenuSelector(r),i.submenuOpenClass(m),i.isTopLevel(a),i.isDropdown(f,d),this.domElements={menu:n,controller:f,container:d,menuItems:Array.from(n.querySelectorAll(s)).filter((function(e){return e.parentElement===n})),submenuItems:Array.from(n.querySelectorAll(o)).filter((function(e){return e.parentElement===n}))},this.domSelectors={"menu-items":s,"submenu-items":o,"submenu-toggle":u,submenu:r},this.elements={menuItems:[],menuToggles:[]},this.focussedChild=-1,this.focusState="none",this.openClass=m,this.root=a}return _createClass(e,[{key:"initialize",value:function(){(this.element.setAttribute("role","menu"),this.element.tabIndex=0,this.createMenuItems(),this.handleKeydown(),this.handleClick(),this.controllerElement&&this.containerElement)&&new s({menuToggleElement:this.controllerElement,parentElement:this.containerElement,menu:this,openClass:this.openClass}).initialize()}},{key:"createMenuItems",value:function(){var n=this;this.menuItemElements.forEach((function(i){var o=new t({menuItemElement:i,parentMenu:n});if(n.elements.menuItems.push(o),o.initialize(),n.submenuItemElements.includes(i)){var u=i.querySelector(n.selector["submenu-toggle"]),r=new e({menuElement:i.querySelector(n.selector.submenu),menuItemSelector:n.selector["menu-items"],submenuItemSelector:n.selector["submenu-items"],submenuToggleSelector:n.selector["submenu-toggle"],submenuSelector:n.selector.submenu,submenuOpenClass:n.openClass,isTopLevel:!1});r.initialize();var l=new s({menuToggleElement:u,parentElement:i,menu:r,openClass:n.openClass,parentMenu:n});l.initialize(),n.elements.menuToggles.push(l)}}))}},{key:"handleKeydown",value:function(){var e=this;function t(e){e.preventDefault(),e.stopPropagation()}this.element.addEventListener("keydown",(function(n){var s=n.key,i=n.code,o=n.altKey,u=n.crtlKey,r=n.metaKey,l=o||u||r;"none"===e.currentFocus?("Enter"===s||" "===s&&"Space"===i)&&(t(n),e.currentFocus="self",e.focusFirstChild()):"self"===e.currentFocus&&("Escape"===s?(t(n),e.focus(),e.currentFocus="none"):e.isTopLevel||"ArrowUp"!==s?e.isTopLevel&&"ArrowRight"===s?(t(n),e.focusNextChild()):e.isTopLevel||"ArrowDown"!==s?e.isTopLevel&&"ArrowLeft"===s?(t(n),e.focusPreviousChild()):"Home"===s?(t(n),e.focusFirstChild()):"End"===s?(t(n),e.focusLastChild()):s.match(/^[a-zA-Z]{1}$/)&&!l&&(t(n),e.focusNextChildWithCharacter(s)):(t(n),e.focusNextChild()):(t(n),e.focusPreviousChild())),"none"!==e.currentFocus&&"Tab"===s&&(e.blur(),e.closeChildren())}))}},{key:"handleClick",value:function(){var e=this;document.addEventListener("click",(function(t){e.element.contains(t.target)||e.element===t.target||(e.blur(),e.closeChildren())}))}},{key:"focus",value:function(){this.focussedChild=0,this.currentFocus="self",this.element.focus()}},{key:"blur",value:function(){this.focussedChild=-1,this.currentFocus="none",this.element.blur()}},{key:"focusFirstChild",value:function(){this.focussedChild=0,this.focusCurrentChild()}},{key:"focusLastChild",value:function(){this.focussedChild=this.menuItems.length-1,this.focusCurrentChild()}},{key:"focusNextChild",value:function(){this.focussedChild===this.menuItems.length-1?this.focusFirstChild():(this.focussedChild=this.focussedChild+1,this.focusCurrentChild())}},{key:"focusPreviousChild",value:function(){0===this.focussedChild?this.focusLastChild():(this.focussedChild=this.focussedChild-1,this.focusCurrentChild())}},{key:"focusCurrentChild",value:function(){-1!==this.focussedChild&&this.menuItems[this.focussedChild].focus()}},{key:"focusNextChildWithCharacter",value:function(e){for(var t=e.toLowerCase(),n=this.focussedChild+1,s=!1;!s&&n<this.menuItems.length;){this.menuItems[n].element.innerText.toLowerCase().startsWith(t)&&(s=!0,this.focussedChild=n,this.focusCurrentChild()),n++}}},{key:"closeChildren",value:function(){this.menuToggles.forEach((function(e){return e.close()}))}},{key:"element",get:function(){return this.domElements.menu}},{key:"controllerElement",get:function(){return this.domElements.controller}},{key:"containerElement",get:function(){return this.domElements.container}},{key:"menuItemElements",get:function(){return this.domElements.menuItems}},{key:"submenuItemElements",get:function(){return this.domElements.submenuItems}},{key:"menuItems",get:function(){return this.elements.menuItems}},{key:"menuToggles",get:function(){return this.elements.menuToggles}},{key:"selector",get:function(){return this.domSelectors}},{key:"currentFocus",get:function(){return this.focusState},set:function(e){if(!["self","child","none"].includes(e))throw new Error("Focus state must be 'self', 'child', or 'none'.");this.focusState=e}},{key:"openClass",get:function(){return this.submenuOpenClass},set:function(e){if("string"!=typeof e)throw new TypeError("Class must be a string.");this.submenuOpenClass=e}},{key:"isTopLevel",get:function(){return this.root},set:function(e){if("boolean"!=typeof e)throw new TypeError("Top-level flag must be true or false.");this.root=e}}]),e}();return o}();